##  网络协议
![avatar](./img/1.jpg)

### ifconfig ，ip addr 两种查看ip的方式的区别？（linux下）
net-tools起源于BSD，自2001年起，Linux社区已经对其停止维护，而iproute2旨在取代net-tools，并提供了一些新功能。一些Linux发行版已经停止支持net-tools，只支持iproute2。

### ip地址，mac地址的区别？
1. IP 地址是一个网卡在网络世界的通讯地址，相当于我们现实世界的门牌号码。  
2. MAC 地址更像是身份证，是一个唯一的标识。  
3. IP 是地址，有定位功能；MAC 是身份证，无定位功能；
```shell
    en0: flags=8863<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500
            ether f0:18:98:69:ed:b9
            inet6 fe80::10fa:ea68:ea89:8df7/64 secured scopeid 0xb
            inet 192.168.199.175/24 brd 192.168.199.255 en0
```

### ip
1. ip一开始32位，不够用。所以出现ipv6；  
2. 共有ip和私有ip？  
公有 IP 地址有个组织统一分配，你需要去买。但是假如你要做一个个人网站，就需要有公有ip，全世界才可以访问；  
平时我们看到的数据中心里，办公室、家里或学校的 IP 地址，一般都是私有 IP 地址段。因为这些地址允许组织内部的 IT人员自己管理、自己分配，而且可以重复。因此，你学校的某个私有 IP 地址段和我学校的可以是一样的。  
这就像每个小区有自己的楼编号和门牌号，你们小区可以叫 6 栋，我们小区也可以叫6栋；但是一旦出了小区，就需要使用公有 IP 地址；  
3. 无类型域间选路（CIDR）？  
inet 192.168.199.175/24  ：斜杠后面有个数字24。这种地址表示形式，就是 CIDR。  
后面 24 的意思是，32 位中，前 24 位是网络号，后8位是主机号。

### 如何配置 IP 地址？
使用 net-tools：
```shell
    $ sudo ifconfig eth1 10.0.0.1/24
    $ sudo ifconfig eth1 up
```
使用iproute2
```shell
    $ sudo ip addr add 10.0.0.1/24 dev eth1
    $ sudo ip link set up eth1
```
### 从IP地址 16.158.23.6,发包到ip地址 192.168.1.2为什么发不过去？
1. 因为mac层还没有填；
2. Linux 首先会判断，要去的这个地址和我是一个网段的吗，或者和我的一个网卡是同一网段的吗？只有是一个网段的，它才会发送 ARP 请求，获取 MAC 地址；
3. Linux 默认的逻辑是，如果这是一个跨网段的调用，它便不会直接将包发送到网络上，而是企图将包发送到网关；
4. 如果你配置了网关的话，Linux 会获取网关的 MAC 地址,然后将包发送出去。如果没有配置网关，那包压根就发不出去；
5. 网关要和当前的网络至少一个网卡是同一个网段的，否则linux不会让你配置成功的；

### 动态主机配置协议（DHCP）
1. 自动帮你配置ip的协议；
2. 如果是数据中心里面的服务器，IP 一旦配置好，基本不会变，这就相当于自己买房装修；
3. DHCP 的方式就相当于租房。你不用装修，都是帮你配置好的。你暂时用一下，用完退租就可以了。

### IP 地址的收回和续租
客户机会在租期过去 50% 的时候，直接向为其提供 IP 地址的 DHCP Server 发送 DHCP request消息包。客户机接收到该服务器回应的 DHCP ACK 消息包。会根据包中所提供的新的租期以及其他已经更新的 TCP/IP 参数，更新自己的配置。这样，IP 租用更新就完成了。

### 预启动执行环境（PXE）（Pre-boot Execution Environment)
1. 网络管理员不仅能自动分配 IP 地址，还能帮你自动安装操作系统。
2. 首先，启动 PXE 客户端。第一步是通过 DHCP 协议告诉DHCP Server，我刚来，一穷二白，啥都没有。DHCP便租给它一个 IP 地址，同时也给它 PXE 服务器的地址、、启动文件 pxelinux.0。
3. 这样 PXE 客户端启动之后，发送 DHCP 请求之后，除了能得到一个 IP 地址，还可以知道 PXE 服务器在哪里，也可以知道如何从 PXE 服务器上下载某个文件，去初始化操作系统。
4. DHCP 协议能给客户推荐“装修队”PXE，能够安装操作系统，这个在云计算领域大有用处。
![avatar](./img/2.jpg)

### 如何在宿舍里自己组网玩联机游戏？
1. 不用wifi，电脑连电脑的网线，配置同域ip，就构成了一个最小的*局域网*，即*LAN*。

###  MAC层，链路层
1. MAC 层是用来解决多路访问的堵车问题的；
2. ARP 是通过吼的方式来寻找目标 MAC 地址的，吼完之后记住一段时间，这个叫作缓存；
3. 交换机是有 MAC 地址学习能力的，学完了它就知道谁在哪儿了,不用广播了。
4. 当交换机的数目越来越多的时候，会遭遇环路问题，让网络包迷路，这就需要使用 STP 协议，将有环路的图变成没有环路的树，从而解决环路问题。
5. 交换机数目多会面临隔离问题，可以通过 VLAN 形成虚拟局域网，从而解决广播问题和安全问题。
6. 在二层中我们讲了 ARP 协议，即已知 IP 地址求 MAC；还有一种 RARP 协议，即已知 MAC 求 IP 的。

### ICMP与ping：投石问路的侦察兵
1. ping 是基于 ICMP 协议工作的。*ICMP*全称*Internet Control Message Protocol*，就是*互联网控制报文协议*。
2. 两种类型的 ICMP 报文，一种是主动探查的查询报文，一种异常报告的差错报文；
3. ping 使用查询报文，Traceroute 使用差错报文。

### UDP协议
* TCP 和 UDP 有哪些区别？
1. TCP 是面向连接的，UDP 是面向无连接的。
2. TCP 提供可靠交付。通过 TCP 连接传输的数据，无差错，不丢失、不重复、并且按序到达。而UDP 继承了 IP 包的特性，不保证不丢失，不保证按顺序到达。
3. TCP 是可以有拥塞控制的，它意识到包丢弃了或者网络的环境不好了，就会根据情况调整自己的行为，看看是不是发快了，要不要发慢点。UDP 就不会，应用让我发，我就发，管它洪水滔天。
4. TCP 其实是一个有状态服务，通俗地讲就是有脑子的，里面精确地记着发送了没有，接收到没有，发送到哪个了，应该接收哪个了，错一点儿都不行。而 **UDP 则是无状态服务。** 通俗地说是没脑子的，天真无邪的，发出去就发出去了。

* UDP 的三大使用场景
1. 需要资源少，在网络情况比较好的内网，或者对于丢包不敏感的应用；
2. 不需要一对一沟通，建立连接，而是可以广播的应用；
3. 需要处理速度快，时延低，可以容忍少数丢包，但是要求即便网络拥塞，也毫不退缩，一往无前的时候

* 基于 UDP 的五个例子
1. *网页或者 APP* 的访问。QUIC（全称Quick UDP Internet Connections，快速 UDP 互联网连接）是 Google 提出的一种基于 UDP 改进的通信协议，其目的是降低网络通信的延迟，提供更好的用户互动体验。QUIC 在应用层上，会自己实现快速连接建立、减少重传时延，自适应拥塞控制，是应用层“城会玩”的代表。
2. 很多*直播应用*，都基于 UDP 实现了自己的视频传输协议。另外，对于丢包，其实对于视频播放来讲，有的包可以丢，有的包不能丢，因为视频的连续帧里面，有的帧重要，有的不重要，如果必须要丢包，隔几个帧丢一个，其实看视频的人不会感知，但是如果连续丢帧，就会感知了，因而在网络不好的情况下，应用希望选择性的丢帧。还有就是当网络不好的时候，TCP 协议会主动降低发送速度，这对本来当时就卡的看视频来讲是要命的，应该应用层马上重传，而不是主动让步。因而，很多直播应用，都基于 UDP 实现了自己的视频传输协议。
3. *实时游戏*。游戏对实时要求较为严格的情况下，采用自定义的可靠 UDP 协议，自定义重传策略，能够把丢包产生的延迟降到最低，尽量减少网络问题对游戏性造成的影响。
4. *IoT 物联网*。物联网对实时性要求也很高，而 TCP 还是因为上面的那些原因导致时延大。
5. *移动通信领域*。如果基于 TCP，TCP 的机制就显得非常多余。





































